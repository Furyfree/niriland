#!/usr/bin/env bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/../lib/common"

log "Configuring VMware Workstation"

has_systemd_unit() {
  local unit="$1"
  [[ -f "/usr/lib/systemd/system/$unit" || -f "/etc/systemd/system/$unit" ]]
}

enable_service_if_present() {
  local service="$1"

  if has_systemd_unit "$service"; then
    if run_sudo systemctl enable --now "$service"; then
      log "$service enabled and started."
    else
      warn "Failed to enable/start $service."
    fi
  else
    warn "$service not found; skipping."
  fi
}

install_package vmware-workstation
enable_service_if_present "vmware-networks.service"
enable_service_if_present "vmware-usbarbitrator.service"

log_success "VMware setup complete."
