#!/bin/bash

# Print a browser app-id matcher for nirius based on the current default browser.

fallback_browser_app_id() {
  echo "zen|helium"
}

if ! command -v xdg-settings >/dev/null 2>&1; then
  fallback_browser_app_id
  exit 0
fi

default_browser=$(xdg-settings get default-web-browser 2>/dev/null || true)
default_browser=${default_browser%%$'\n'*}
default_browser=${default_browser%.desktop}

if [[ -z "$default_browser" ]]; then
  fallback_browser_app_id
  exit 0
fi

browser_exec=$(sed -n 's/^Exec=\([^ ]*\).*/\1/p' {~/.local,~/.nix-profile,/usr}/share/applications/"$default_browser".desktop 2>/dev/null | head -1)
browser_exec=${browser_exec##*/}

if [[ -n "$browser_exec" && "$browser_exec" != "$default_browser" ]]; then
  printf "%s|%s\n" "$default_browser" "$browser_exec"
else
  printf "%s\n" "$default_browser"
fi
